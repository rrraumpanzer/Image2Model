**Запуск**


``poetry shell``


``poetry update``


``uvicorn image2model.__main__:app --host 0.0.0.0 --port 8000``

*Несмотря на то, что имеется код для перезапуска сервера при изменении файла, чтобы запросы к ним работали, его нужно перезапустить вручную и я не понимаю почему*

**Проверка эндпоинтов:**


Для изображения:

``curl -X POST -F 'image=@test_image.jpg' http://localhost:8000/image``


``curl -o image.jpg http://localhost:8000/image`` 

 (Сохранит результат GET запроса в image.jpg)
 

Получение сегментированной картинки:


``curl -o image.jpg http://localhost:8000/processed-image``


Для координат объекта:


``http POST localhost:8000/coords <<<'{ "ul_x": 337, "ul_y": 279, "lr_x": 973, "lr_y": 1024}'``

``http GET localhost:8000/coords``

Отправка сигнала начала работы:


``http POST localhost:8000/process``


**Принцип работы:**


Сначала загружаем картинку:

``curl -X POST -F 'image=@test_image.jpg' http://localhost:8000/image``

Далее загружаем координаты левого верхнего и правого нижнего углов коробочки, выделяющей объект:

 (Или не загружаем, тогда сеть будет предполагать, что объект занимает большую часть изображения)

``http POST localhost:8000/coords <<<'{ "ul_x": 337, "ul_y": 279, "lr_x": 973, "lr_y": 1024}'``

Отправляем POST запрос чтобы дать сигнал к обработке:  

 (Сейчас process делает только сегментацию, потом здесь же будет выполняться и моделирование, то есть запрос будет очень долго выполняться. Стоит ли сделать промежуточный результат, чтобы пользователь мог проверить правильно ли удаляется фон?)

``http POST localhost:8000/process``

Ждём. После выполнения отправляем GET запрос, чтобы получить готовое изображение.

``curl -o image.jpg http://localhost:8000/processed-image``

 (если координаты не ввести будет сегментироваться вся картинка, что может вызвать непредсказуемый результат)





/// Для сегментации надо установить refiners через pip
/// Результат в image.png
``pip install git+https://github.com/finegrain-ai/refiners``